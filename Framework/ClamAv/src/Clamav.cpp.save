#include "Clamav.hh"
#include <SystemPath.hh>



    void WhiteHawkClamav::Clamav::scanSubFolder(std::string path)
    {
         WhiteHawkSystem::SystemPath  path(path);

           do
           {
                ClamFile file( path.getNextFile().getPath());

                if( !file.isFile() && ! tmp.isDevice())
                    scanSubFolder( file.getPath() );
                else
                {
                    file.setId(id);
                    this->scanFile(file);
                    id++;
                }
           }while( !path.isEnd() );
    }

	void WhiteHawkClamav::Clamav::ThreadRoutine()
	{
		if( defaultPath.empty())
			return;

            id9+

          ClamFile tmp(defaultPath);

       		 if( tmp.isFile())
     		    this->scanFile(tmp);
       		 else if( tmp.isDevice());
        	 else
        	 {


                   WhiteHawkSystem::SystemPath   path(defaultPath);

                    m_total = list.size();
                    iter=list.begin();

                   do
                    {
                        ClamFile file( path.getNextFile().getPath());
                        file.setId(id);
                        this->scanFile(file);
                        id++;
                    }while( !path.isEnd() );
        	}

		listener->onFinish();
	}

	void WhiteHawkClamav::Clamav::startScan(std::string path)
	{
	    if( isDBLoaded())
	    {
            defaultPath = path;
            Create();
	    }
	}

	int WhiteHawkClamav::Clamav::getTotalFiles()
	{
	  return m_total;
	}

   	int WhiteHawkClamav::Clamav::getDatabaseAge()
   	{
      	  return 0;
   	}

   	void WhiteHawkClamav::Clamav::onTerminate()
   	{
		listener->onFinish();
   	}

